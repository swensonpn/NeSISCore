nesis={_init:function(a){a=a||{};document.domain=a.domain||location.host;nesis.debugOn=a.debugOn||!0;this.core.store._init({debug:a.storeDebug||!1,flush:a.storeFlush||!1});this.core.error._init({logLevel:a.logLevel||0,maxLogSize:a.logSize||20,remoteUrl:a.logSubmit||location.host});this.mvc.debugTiming=a.debugTiming||!1;this.mvc.debugEventFired=a.debugHandlers||!1;this.mvc.debugEventBind=a.debugBind||!1;this.mvc.debugEventUnbind=a.debugUnbind||!1;this.mvc.debugCache=a.debugCache||!1;this.mvc.debugAjax=
a.debugAjax||!1;this.mvc.ajaxReqCacheDelay=a.ajaxRetry||2E3},core:{},net:{}};
nesis.core.error={key:"nesisCoreError",logLevel:0,maxLogSize:20,remoteUrl:"",_init:function(a){for(i in a)this[i]=a[i];nesis.debugOn||(window.onerror=function(a,c,b){a&&(c&&b)&&nesis.core.error.log({name:"Error",message:a,fileName:c,lineNumber:b});return!0})},handle:function(a){var d=Date()+"\n\t"+a.name+": "+a.message;if(a.stack){a=a.stack.split("\n");for(var c=0,b=a.length;c<b;c++)a[c].match(/http[.]*/i)&&(d+="\n\tLocation: "+a[c].substr(a[c].indexOf("http"))+"\n")}this.log(d)},log:function(a){var d=
nesis.core.store,c=nesis.core.error.key,b=[];if(2>this.logLevel)if(d.supported){var g=d.get(c),b=g?g:b;for(b.push(a);b.length>this.maxLogSize;)b.shift();d.set(c,b,!0)}else b.push(a);1==this.logLevel?this.submit(b.join("\n")):2==this.logLevel&&console.log("%c"+a,"color:FireBrick;")},submit:function(a){var d=function(){nesis.core.store.clear(nesis.core.error.key)};if(this.remoteUrl)try{nesis.net.http.ajax(this.remoteUrl,{post:{errorList:a},callback:d})}catch(c){console.log("nesis.core.error.sumbit: Error sending log\n\t"+
c.message)}else console.log("Remote URL not set")}};nesis.core.browser=function(){var a=navigator.appName,d=navigator.userAgent,c,b=d.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);b&&null!=(c=d.match(/version\/([\.\d]+)/i))&&(b[2]=c[1]);return b=b?[b[1],b[2]]:[a,navigator.appVersion,"-?"]};
nesis.core.cache=function(a){var d=this,c={},b=[],g,h,e={l1Max:50,l1Exp:3E4,clearInt:5E3},n=function(){c={};for(var a=0,k=b.length;a<k;a++)c[b[a].key]=b[a]};d.clear=function(){b=[];g={};h={}};d.get=function(b,a,q){if(q)a.data=void 0;else{if(c[b])return c[b];if(g[b])return JSON.parse(g[b]);if(h[b])return q=JSON.parse(h[b]),a.lastModified&&q.stamp>a.lastModified||a.expires&&q.stamp<a.expires?d.set(b,a):q}return d.set(b,a)};d.set=function(a,k){k.key=a;k.stamp=new Date;k.datasource&&!k.data&&(k=k.datasource(k));
if(!k.data)return k;c[a]?b[c[a]]=k:c[a]=b[b.length]=k;k.persist?h[a]=JSON.stringify(k):g[a]=JSON.stringify(k);return k};d.toString=function(){for(var a="Cache:l1[\n",k,c=0,d=b.length;c<d;c++){a+="\t{\n";for(k in b[c])a+="\t\t"+k+": "+b[c][k]+"\n";a+="\t}\n"}a+="]\nCache:l2{\n";for(k in g)a+="\t"+k+": "+g[k]+"\n";a+="}\nCache:l3{\n";for(k in h)a+="\t"+k+": "+h[k]+"\n";return a+"}"};for(var p in a)e[p]=a[p];g=sessionStorage||{};h=localStorage||{};setInterval(function(){(new Date).getTime();for(b.sort(function(b,
a){return a.stamp-b.stamp});0<b.length;)b.pop();n();"undefined"==typeof Storage&&(g={},h={})},e.clearInt)};
nesis.core.store={supported:!1,_init:function(a){this.supported=typeof Storage&&JSON?!0:!1;this.debug=a.debug||!1;a.flush&&this.flush();this.debug&&console.log("nesis.core.store.supported: "+this.supported)},clear:function(a){localStorage[a]?localStorage[a]=null:sessionStorage[a]&&(sessionStorage[a]=null);this.debug&&console.log("nesis.core.store.clear: "+a+" has been cleared")},flush:function(){localStorage.clear();sessionStorage.clear()},get:function(a){var d,c;sessionStorage[a]?(d=eval(sessionStorage[a]),
c="sessionStorage"):localStorage[a]&&(d=eval(localStorage[a]),c="localStorage");this.debug&&console.log("nesis.mvc.model.get: \n\t"+c+"."+a+"="+d);return d},set:function(a,d,c){(!0===c?localStorage:sessionStorage)[a]=JSON.stringify(d);this.debug&&console.log("nesis.core.store.set: persistent="+c+", "+a+"=\n\t"+d)}};
nesis.net.http={ajax:function(a,d){var c={callback:function(){},defer:!1},b,g=function(b,a){var c;this.send=function(){var k=a.post?"post":"get",d="";if(a.post)for(e in a.post)d+=e+"="+a.post[e]+"&";c.onreadystatechange=function(){4!=c.readyState||200!=c.status&&304!=c.status||a.callback(c)};c.open(k,b,!0);c.setRequestHeader("X-Requested-With","XMLHttpRequest");a.post&&c.setRequestHeader("Content-type","application/x-www-form-urlencoded");c.send(d)};if(window.XMLHttpRequest)c=new XMLHttpRequest;else try{c=
new ActiveXObject("Microsoft.XMLHTTP")}catch(k){}if(!c)throw Error("nesis.net.http.ajax.xmlHttp: Failed to initialize request object");c.onerror=function(b){console.log("nesis.net.http.ajax.xmlHttp.onerror: Status="+c.status+" ReadyState="+c.readyState+" "+(0==c.status||null==c.status?"Security Violation cross-domain":c.statusText))}},h=function(b,a){var c=(new Date).getTime();b+=-1<b.search(/\?/)?"&":"?";b+="async=true&jsoncallback=call"+c;a.post?(nesis.net.http["call"+c]=function(b){try{a.callback(b);
var c=b.callBackName.replace(/call/,"timeout");clearTimeout(nesis.net.http[c]);document.body.removeChild(document.getElementById(b.callBackName.replace(/call/,"jsonpDiv")))}catch(d){Error("JSONP POST ERROR: "+d.message)}},this.send=function(){var k=b,d=a.post,h=document.createElement("div"),e='<iframe name="ifr'+c+'"></iframe>',e=e+('<form target="ifr'+c+'" method="POST" action="'+k+'" id="frm'+c+'">'),g;for(g in d)e+='<input name="'+g+'" value="'+d[g]+'"/>';h.id="jsonpDiv"+c;h.style.display="none";
h.innerHTML=e+"</form>";document.body.appendChild(h);nesis.net.http["timeout"+c]=setTimeout('console.log("timeout");',4E3);document.getElementById("frm"+c).submit()}):(nesis.jsonp["call"+c]=function(b){try{a.callback(b),document.body.removeChild(document.getElementById(b.callBackName.replace(/call/,"jsonpDiv")))}catch(c){Error("JSONP GET ERROR: "+c.message)}},this.send=function(){var a=b,d=document.createElement("div"),h=document.createElement("script");document.body.appendChild(d);h.type="text/javascript";
h.src=a;d.id="jsonpDiv"+c;d.appendChild(h)})};this.send=function(a){c.callback=a||c.callback;b.send()};if("[object Object]"===Object.prototype.toString.call(d))for(var e in d)c[e]=d[e];else throw Error("nesis.net.http: param options must be type Object");0!=a.indexOf("http")&&(a=location.protocol+"//"+location.host+"/"+a);b=-1!=a.search(window.location.host)?new g(a,c):new h(a,c);c.defer||this.send()},pjax:function(a,d){},reload:function(){},redirect:function(){}};
nesis.mvc=function(){var a=nesis.core;document.addEventListener&&(document.addEventListener("DOMContentLoaded",function(){console.log("document ready: fired")},!0),window.addEventListener("load",function(){this.debugTiming&&console.log("window load: fired")},!0));this.extend=function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return a};this.fMerge=function(a,c){var b=a instanceof Function,g=c instanceof Function;return b&&g?function(b){return a(c.apply(null,arguments))}:b?a:g?c:function(){}};
this.gui={};this.datasource={};this.cache=new a.cache;this.error=a.error;return this}();
nesis.mvc.gui.tabsAjax=function(a){if(!(!a.target instanceof View)){a=a.target;var d=a.querySelector(".mvc-tab-list"),c=[],b,g=a.querySelector(".mvc-tab-content"),h=function(b){b=b.target.getAttribute("href");for(var a=0,d=c.length,a=0;a<d;a++)c[a].className=c[a].getAttribute("href")==b?"active":"";g.id=b.slice(1,-1)};a.parent().children().each(function(){var a=this,n=document.createElement("a"),p=this.attr("id");"Controller"==a.attr("type")&&(this.bind("beforerender",function(b){if(b.target==a.view()){b=
a.attr("path");var k=0,d=c.length;g.id=b;for(k=0;k<d;k++)c[k].className=c[k].getAttribute("href").slice(1,-1)==b?"active":""}}),n.href="#"+this.attr("path")+"/",n.title=this.attr("description")||p,n.innerHTML=this.attr("label")||p,n.addEventListener("click",h,!0),this.attr("defaultNode")&&(n.className="active"),c.push(n),b=document.createElement("li"),b.appendChild(n),d.appendChild(b))})}};
nesis.mvc.gui.accordianStatic=function(a){if(!(!a.target instanceof View)){var d=a.target,c=d.querySelectorAll(".mvc-accordian-actuator a"),b=0,g=c.length;for(a=function(a){a.preventDefault();for(b=0;b<g;b++)this==c[b]?(c[b].className="active",d.querySelector(c[b].getAttribute("href")).style.display="block"):(c[b].className="",d.querySelector(c[b].getAttribute("href")).style.display="none")};b<g;b++)"active"!=c[b].className&&(d.querySelector(c[b].getAttribute("href")).style.display="none"),c[b].addEventListener("click",
a,!1)}};nesis.mvc.gui.formAjax=function(a){var d=a.target;a=d.querySelectorAll("form");for(var c=a.length;0<c;c--)a[c-1].addEventListener("submit",function(b){var a={};b.preventDefault();b=this.querySelectorAll("input,select,textarea");for(var c=b.length;0<c;c--){var e=c-1,n=b[e].name;n&&(a[n]=b[e].value)}b=document.querySelectorAll('body *[form="'+this.id+'"]');for(c=b.length;0<c;c--)if(e=c-1,n=b[e].name)a[n]=b[e].value;d.parent().model().save(a)},!0)};
nesis.mvc.gui.textEditableAjax=function(a){var d=a.target;a=0;for(var c=d.querySelectorAll('*[contenteditable="true"]'),b=c.length;a<b;a++)c[a].addEventListener("focus",function(a){var b=this.innerHTML,c=function(a){this.removeEventListener("blur",c);b!=this.innerHTML&&(a={},a[this.id]=this.innerHTML.replace(/(<([^>]+)>)/ig,""),d.parent().model().save(a))};this.addEventListener("blur",c,!0)},!0)};
nesis.mvc.gui.lightbox=function(a){var d=a.target;a=a.arguments[1];!d instanceof View||(d.querySelector(".mvc-lightbox-close a").addEventListener("click",function(a){a=d.querySelector(".mvc-lightbox").parentNode;a.parentNode.removeChild(a)},!0),a&&(d.querySelector(".mvc-lightbox-content").innerHTML=a))};
nesis.mvc.gui.tabsStatic=function(a){if(!(!a.target instanceof View)){a=a.target.querySelector(".mvc-tabs").children;var d=a[0].querySelectorAll("a"),c=d.length;handler=function(a){a.preventDefault();for(a=0;a<c;a++){var b=document.getElementById(d[a].getAttribute("href").slice(1));d[a]===this?(d[a].className="active",b.style.display="block"):(d[a].className="",b.style.display="none")}};for(var b=0,c=d.length;b<c;b++)d[b].addEventListener("click",handler,!1),"active"!=d[b].className&&(a[b+1].style.display=
"none")}};
nesis.mvc.gui.typeahead=function(a,d){if(!(!a.target instanceof View)){var c=a.target,b=c.querySelector(".mvc-typeahead"),g,h,e,n,p=document.createElement("input"),r,k=document.createElement("ul"),q={datasource:void 0,results:!0,searchOn:"id",resultValue:"id",resultLabel:"title",limit:5},s,t;d=d||{};for(var u in d)q[u]=d[u];h=q.datasource;t=h instanceof nesis.mvc.Model?!1:!0;n=q.searchOn.split(",");h&&b?(t?g=h instanceof Array?function(a){a=[];for(var b=0,k=h.length;b<k;b++)for(var d in h[b])if(-1<n.indexOf(d)&&
-1<h[b][d].search(RegExp(this.value,"i"))){var e={};e[q.resultValue]=h[b][q.resultValue];e[q.resultLabel]=h[b][q.resultLabel];a.push(e);break}s(c.parent().attr("path"),a)}:function(a){a="refresh=true&limit="+q.limit;for(var b=0,k=n.length;b<k;b++)a+="&"+n[b]+"="+this.value;h+=0<h.indexOf("?")?"&"+a:"?"+a;nesis.net.http.ajax(h,{callback:function(a){a=JSON.parse(a.responseText);s(c.parent().attr("path"),a.data)}})}:(q.results&&h.bind("aftersync",function(a){a=a.arguments.data.data;var b=h.parent().attr("path");
s(b,a)}),g=function(a){a={limit:q.limit};for(var b=0,c=n.length;b<c;b++)a[n[b]]=this.value;h.sync(a,!0)}),e=function(a){var b=this.value.length;2<b||"keyup"!=a.type?(k.style.display="block",r=b,g.call(this,a)):k.style.display="none"},s=function(a,b){if(0<r&&b instanceof Array){for(var c="",d,e=q.limit<b.length?q.limit:b.length,h=0;h<e;h++)t?c+='<li><span data-value="'+b[h][q.resultValue]+'">'+b[h][q.resultLabel]+"</span></li>":(d="#"+a+"/"+q.resultValue+":"+b[h][q.resultValue]+"/refresh:true",c+=
'<li><a href="'+d+'">'+b[h][q.resultLabel]+"</a></li>");k.innerHTML=c}},p.value=a.arguments[0][p.name]||"",p.name=d.searchKey||"search",p.type="text",p.setAttribute("placeholder","Search"),p.title="Type to Search",r=p.value.length,p.addEventListener("keyup",e,!1),p.addEventListener("paste",function(a){setTimeout(function(){e.call(p,a)})},!1),p.addEventListener("cut",e,!1),k.addEventListener("click",function(a){p.value=a.target.innerHTML;this.style.display="none";if(t){var b={};b[q.resultValue]=a.target.getAttribute("data-value");
b[q.resultLabel]=p.value;c.trigger(new nesis.mvc.Event("change",{arguments:b}))}},!1),b.appendChild(p),b.appendChild(k)):c.attr("debug")&&console.log("nesis.mvc.gui.typeahead("+c.attr("id")+"): Failed datasource or placeholer not found.")}};nesis.mvc.datasource.dom=function(a){var d=document.getElementById(a.domId);d?a.data=d.innerHTML:setTimeout(function(){nesis.mvc.datasource.dom(a)},200);return a};
nesis.mvc.datasource.ajax=function(a){if(navigator.onLine)nesis.net.http.ajax(a.url,a);else{var d=new Date,d="onconnect"+o.attr("id")+d.getTime(),c=function(){navigator.onLine?nesis.net.http.ajax(o.attr("remoteURL"),ajaxOpts):setTimeout(c,this.mvc.ajaxReqCacheDelay)};ns[d]=setTimeout(c,this.mvc.ajaxReqCacheDelay)}return a};nesis.mvc.Event=function(a,d){if(!a||"string"!=typeof a)return!1;d=d||{};this.type=a;this.bubbles=d.bubbles||!0;this.cancelable=d.cancelable||!0;this.arguments=d.arguments};
nesis.mvc.NodeCollection=function(a){var d=nesis.mvc,c=this,b=0,g=[];a=a instanceof Array?a:[];b=0;for(l=a.length;b<l;b++)a[b]instanceof d.Node&&g.push(a[b]);c.append=function(a){return a instanceof d.Node?(g.push(a),c.length=g.length,!0):!1};c.each=function(a){if(a&&"function"==typeof a)for(b=0,l=g.length;b<l;b++)a.call(g[b],b)};c.find=function(a,b,c){for(var p=[],r=0,k=g.length;r<k;r++){if(g[r].attr([a])==b){if("id"==a)return g[r];p.push(g[r])}if(c&&g[r].children&&0<g[r].children().length){var q=
g[r].children().find(a,b,!0);if(q instanceof d.Node)return q;p=p.concat(q)}}return p};c.length=g.length;c.remove=function(a){b=0;for(l=g.length;b<l;b++)if(g[b]==a)return g.splice(b,1),c.length=g.length,a};c.toString=function(a){for(var b="";0<a;a--)b+="\t";a=""+(b+"Collection("+g.length+"){\n");for(var c=0,d=g.length;c<d;c++)a+=b+"\t"+(g[c].attr("type")||"Node")+"("+(g[c].attr("id")||"")+")\n";return a+b+"}\n"}};
nesis.mvc.Node=function(a,d){var c=nesis.mvc,b=this,g={},h=new c.NodeCollection(d||[]),e="nesis.mvc.",n=a instanceof Object?a:{},p=["id","type","path","parent"];b.append=function(a){var c=h.append(a);n.debug&&c&&console.log(e+"append: "+a.attr("id"));return b};b.attr=function(a,c){if(!a)return n;if(!c)return n[a];-1==p.indexOf(a)&&(n[a]=c);return b};b.bind=function(a,b){var d="fail",p=e+"bind(";b&&"function"==typeof b?a&&"string"==typeof a?(g[a]||(g[a]=[]),g[a].push(b),p+=a+","+b+")",d="success"):
p+="Not a String,"+b+")":p+=a+",Not a Function)";(c.debugEventBind||n.debug)&&console.log(d+": "+p)};b.children=function(a,b){return a&&b?h.find(a,b):h};b.find=function(a,b){return h.find(a,b,!0)};b.parent=function(){return n.parent};b.remove=function(a){a=h.remove(a);n.debug&&a instanceof c.Node&&console.log(e+"remove:"+a.attr("id"));return b};b.toString=function(){var a="Node:{\n",b;for(b in n)a="parent"==b?a+("\t"+b+": object Node("+n[b].attr("id")+")\n"):a+("\t"+b+": "+n[b]+"\n");a+="\tchildren:\n"+
h.toString(2);return a+"}"};b.trigger=function(a){var d,p=e+"trigger(";if("string"==typeof a)d=new c.Event(a);else if(a instanceof c.Event)d=a;else return;d.target=a.target||b;if(g[d.type]){a=0;for(var h=g[d.type].length;a<h;a++)g[d.type][a].call(b,d),(c.debugEventFired||n.debug)&&console.log(p+d.type+"): "+g[d.type][a]),c.debugTiming&&console.log(p+d.type+"): fired")}d.bubbles&&n.parent&&n.parent.trigger&&n.parent.trigger(d)};b.unbind=function(a,d){var p=0,g;if(b.events[a])for(g=b.events[a].length;p<
g;p++)b.events[a][p]==f&&(b.events[a].splice(p,1),(c.debugEventUnbind||n.debug)&&console.log(e+"unbind("+a+","+d+")"))};a=a&&"object"==typeof a?a:{};for(var r in a)n[r]=a[r];e+=n.id+".";"function"==typeof n.onchange&&b.bind("change",n.onchange);"function"==typeof n.oncreate&&b.bind("create",n.oncreate);b.trigger("create")};
nesis.mvc.Router=function(a){var d=this,c=[],b,g={method:"hashBang"},h=function(a,b){a.scope[a.callback](b)},e=function(a,b,c){};d.addRoute=function(a,b,d){c.push({route:a,callback:b,scope:d})};d.handleRoute=function(a,d){for(var k=c.length-1;-1<k;k--)if(a.match(c[k].route)){for(var e=a.replace(c[k].route,"").split("/").slice(1),g={};0<e.length;){var h=e.shift().split(":");g[h[0]]=h[1]}b(c[k],g,d);break}};d.removeRoute=function(a){};d.toString=function(){var a;a=""+("\t\t\n\t\tRouter("+c.length+"){\n");
for(var b=0,d=c.length;b<d;b++)a+="\t\t\t"+c[b].route+"\n";return a+"\t\t}\n"};for(var n in a)g[n]=a[n];switch(g.method){case "hashBang":b=h;break;case "pushState":b=e;break;default:b=history.pushState?e:h}b==h&&window.addEventListener("hashchange",function(a){a=location.hash.substr(1)||"app";d.handleRoute(a)},!1)};
nesis.mvc.Controller=function(a,d){var c=nesis.mvc,b=this,g={},h=[];b.controller=function(a,d){var k=b.children("id",a);if(!d)return k instanceof Controller?k:null;d.parent=b;k=new c.Controller(a,d);b.append(k);return k};b.execute=function(a){a=a||{};var d=b.model();b.trigger(new c.Event("beforeexecute",{arguments:a}));c.debugTiming&&console.log("execute: "+b.attr("id"));d instanceof c.Model&&d.sync(a);b.trigger(new c.Event("afterexecute",{arguments:a}));b.children().each(function(){this instanceof
c.Controller&&this.attr("defaultNode")&&this.execute(a)})};b.model=function(d){var e=b.children?b.children("id",a+"Model"):void 0;if(!d)return e;if("object"==typeof d){var k,g={};for(k in d)g[k]=d[k];g.id=a+"Model";g.parent=b;d=new c.Model(g);b.remove&&(e&&b.remove(e),b.append(d));return d}};b.view=function(d){var e=b.children?b.children("id",a+"View"):void 0;if(!d)return e;if("object"==typeof d){var k,e={},g;for(k in d)"templates"==k?g=d[k]:e[k]=d[k];e.id=a+"View";e.parent=b;d=new c.View(e,g);b.remove&&
(m&&b.remove(m),b.append(d));return d}};d.model=d.model||{};d.view=d.view||{};for(var e in d)if("model"==e)h.push(b.model(d[e]));else if("view"==e)h.push(b.view(d[e]));else if("subcontrollers"==e&&"object"==typeof d[e])for(var n in d[e])h.push(b.controller(n,d[e][n]));else g[e]=d[e];g.id=a;g.type="Controller";g.path=g.parent?g.parent.attr("path")+"/"+g.id:g.id;c.Node.call(b,g,h)};nesis.mvc.Controller.prototype=Object.create(nesis.mvc.Node.prototype);nesis.mvc.Controller.constructor=nesis.mvc.Controller;
nesis.mvc.Application=function(a){var d=nesis.mvc,c=this,b=a.config||{};a.config=void 0;nesis._init(b);d.Controller.call(c,"app",a);c.attr("router",new d.Router);c.attr("router").addRoute(c.attr("path"),"execute",c);c.bind("create",function(a){c.attr("router").addRoute(a.target.attr("path"),"execute",a.target)})};nesis.mvc.Application.prototype=Object.create(nesis.mvc.Controller.prototype);nesis.mvc.Application.constructor=nesis.mvc.Application;
nesis.mvc.Model=function(a,d){var c=nesis.mvc,b=this,g="nesis.mvc.template."+a.id,h,e;b.save=function(a){b.trigger(new c.Event("beforesave",{arguments:arguments}));nesis.net.http.ajax(b.attr("url"),{post:a,callback:function(a){var d=b.attr("contentType");e.data="text/xml"==d?a.responseXML:a.responseText;e.data="text/json"==d?JSON.parse(e.data):e.data;e=c.cache.set(g,e);e.data&&(args={data:e.data},b.trigger(new c.Event("aftersave",{arguments:args})),b.view().render(args))}})};b.sync=function(a,d){d=
d||a.refresh;b.trigger(new c.Event("beforesync",{arguments:a}));e.callback=function(d){var k=b.attr("contentType");e.data="text/xml"==k?d.responseXML:d.responseText;e.data="text/json"==k?JSON.parse(e.data):e.data;e=c.cache.set(g,e);e.data&&(a.data=e.data,b.trigger(new c.Event("aftersync",{arguments:a})),b.view().render(a))};if(e.url){var k="?",h;for(h in a)k+=h+"="+a[h]+"&";e.url=e.url.split("?")[0]+k}e=c.cache.get(g,e,d);if(e.data)return a.data=e.data,b.trigger(new c.Event("aftersync",{arguments:a})),
b.view().render(a)};b.view=function(){h||(h=b.parent().view());return h};a.contentType=a.contentType||"text/html";a.type="Model";a.datasource=a.url?c.datasource.ajax:c.datasource.dom;void 0!==a.expires&&(a.expires=new Date(a.expires),"Invalid Date"==a.expires&&(a.expires=new Date(0)));void 0!==a.lastModified&&(a.lastModified=new Date(a.lastModified),"Invalid Date"==a.lastModified&&(a.lastModified=new Date((new Date).getTime()+864E5)));c.Node.call(b,a,{});b.append=void 0;b.children=void 0;b.find=void 0;
b.remove=void 0;e={data:a.data,domId:a.domId,url:a.url,datasource:a.datasource,persist:a.persist,lastModified:a.lastModified,expires:a.expires};"function"==typeof b.onbeforesave&&b.bind("beforesave",b.attr("onbeforesave"));"function"==typeof b.onaftersave&&b.bind("aftersave",b.attr("onaftersave"));"function"==typeof b.onbeforesync&&b.bind("beforesync",b.attr("onbeforesync"));"function"==typeof b.onaftersync&&b.bind("aftersync",b.attr("onaftersync"));try{if(a.url||a.domId||a.data)a.data&&c.cache.set(g,
e);else throw Error("nesis.mvc."+b.attr("id")+".contructor: remoteURL or data is required");}catch(n){nesis.core.error.handle(n)}};nesis.mvc.Model.prototype=Object.create(nesis.mvc.Node.prototype);nesis.mvc.Model.constructor=nesis.mvc.Model;
nesis.mvc.View=function(a,d){var c=nesis.mvc,b=this,g,h,e,n=function(a,b){var c=e||h;return b?c.querySelectorAll(a):c.querySelector(a)};b.getElementsByTagName=function(a){try{document.createElement(a)}catch(b){return}return n(a,[])};b.model=function(){g||(g=b.parent().model());return g};b.querySelector=function(a){return n(a)};b.querySelectorAll=function(a){return n(a,!0)};b.render=function(a){var d=document.createElement("span"),g=b.parent(),n=b.model();e=document.createDocumentFragment();switch(n.attr("contentType")){case "text/html":d.innerHTML=
a.data;break;case "text/xml":d.innerHTML="";break;case "text/json":n=a.tpl?b.children("id",a.tpl):b.children("defaultNode",!0)[0];n instanceof c.Template&&(n=n.transform(a.data));if(!1===n)return!1;d.innerHTML=n;break;default:try{throw Error("nesis.mvc."+b.attr("id")+".render: ContentType "+n.attr("contentType")+" not supported");}catch(p){nesis.core.error.handle(p)}}e.appendChild(d);d=new c.Event("beforerender",{arguments:arguments});b.trigger(d);try{h=document.getElementById(g.attr("path")),h.firstChild?
h.replaceChild(e,h.children[0]):h.appendChild(e)}catch(r){r.message="nesis.mvc."+b.attr("id")+".render: document.getElementById('"+g.attr("path")+"') returned null",nesis.core.error.handle(r)}e=null;b.trigger(new c.Event("afterrender",{arguments:arguments}))};b.template=function(a,d){d.id=a;d.type="Template";d.parent=b;return new c.Template(d)};a.type="View";var p=[],r;for(r in d)p.push(b.template(r,d[r]));c.Node.call(b,a,p);b.find=void 0;"function"==typeof b.attr("onbeforerender")&&b.bind("beforerender",
b.attr("onbeforerender"));"function"==typeof b.onafterrender&&b.bind("afterrender",b.attr("onafterrender"));b.getElementById=function(a){a=a.replace(/([ #;?%&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1");return n("#"+a)}};nesis.mvc.View.prototype=Object.create(nesis.mvc.Node.prototype);nesis.mvc.View.constructor=nesis.mvc.View;
nesis.mvc.Template=function(a,d){var c=nesis.mvc,b=this,g,h,e,n=!1,p=function(a){h.data="xsl"==b.attr("templateType")?a.responseXML:a.responseText;c.cache.set("nesis.mvc.template."+e,h);n=!1;return h};b.transform=function(a){if(n)return setTimeout(function(){b.parent().render({data:a,tpl:e})},100),!1;h.callback=function(c){p(c);b.parent().render({data:a,tpl:e})};h=c.cache.get("nesis.mvc.template."+e,h);return h.data?g(h.data,a):!1};if(a.id){e=a.id;a.datasource=a.url?c.datasource.ajax:c.datasource.dom;
a.persist=a.persist||!0;switch(a.templateType){case "javascript":g=function(a,b){if("function"==typeof a)return a(b);try{return(new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"))(b)}catch(d){d.message="nesis.mvc.template("+e+").transform: "+
d.message,c.error.handle(d)}};break;case "xsl":g=function(a,b){};break;default:g=function(){b.debug&&console.log("nesis.mvc.Template("+e+"): Unsupporeted template type"+a.templateType)}}c.Node.call(b,a,d);h={domId:a.domId,url:a.url,callback:p,datasource:a.datasource,persist:a.persist,lastModified:a.lastModified,expires:a.expires};n=!0;h=c.cache.get("nesis.mvc.template."+e,h);h.data&&(n=!1);b.append=void 0;b.bind=void 0;b.children=void 0;b.find=void 0;b.remove=void 0;b.trigger=void 0;b.unbind=void 0}};
nesis.mvc.Template.prototype=Object.create(nesis.mvc.Node.prototype);nesis.mvc.Template.constructor=nesis.mvc.Template;
